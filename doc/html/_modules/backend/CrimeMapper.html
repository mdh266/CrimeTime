<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml" lang="en">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>backend.CrimeMapper &#8212; CrimeTime  documentation</title>
    
    <link rel="stylesheet" href="../../_static/nature.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../../',
        VERSION:     '',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../../_static/jquery.js"></script>
    <script type="text/javascript" src="../../_static/underscore.js"></script>
    <script type="text/javascript" src="../../_static/doctools.js"></script>
    <link rel="top" title="CrimeTime  documentation" href="../../index.html" />
    <link rel="up" title="Module code" href="../index.html" /> 
  </head>
  <body role="document">
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="../../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="nav-item nav-item-0"><a href="../../index.html">CrimeTime  documentation</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="../index.html" accesskey="U">Module code</a> &#187;</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <h1>Source code for backend.CrimeMapper</h1><div class="highlight"><pre>
<span></span><span class="ch">#!/usr/bin/env/python</span>
<span class="kn">from</span> <span class="nn">collections</span> <span class="k">import</span> <span class="n">Counter</span>

<span class="kn">from</span> <span class="nn">datetime</span> <span class="k">import</span> <span class="n">datetime</span>
<span class="kn">from</span> <span class="nn">dateutil.relativedelta</span> <span class="k">import</span> <span class="n">relativedelta</span>

<span class="kn">import</span> <span class="nn">sqlite3</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>

<span class="kn">from</span> <span class="nn">geopy.geocoders</span> <span class="k">import</span> <span class="n">Nominatim</span>
<span class="kn">from</span> <span class="nn">geopy.distance</span> <span class="k">import</span> <span class="n">great_circle</span>

<span class="kn">import</span> <span class="nn">geopandas</span> <span class="k">as</span> <span class="nn">gpd</span> 
<span class="kn">from</span> <span class="nn">shapely.geometry</span> <span class="k">import</span> <span class="n">Point</span>

<span class="kn">from</span> <span class="nn">shapely.geometry</span> <span class="k">import</span> <span class="n">Point</span><span class="p">,</span> <span class="n">MultiPoint</span><span class="p">,</span> <span class="n">MultiPolygon</span>
<span class="kn">from</span> <span class="nn">descartes</span> <span class="k">import</span> <span class="n">PolygonPatch</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>


<span class="kn">from</span> <span class="nn">statsmodels.tsa.seasonal</span> <span class="k">import</span> <span class="n">seasonal_decompose</span>
<span class="kn">import</span> <span class="nn">sys</span>
<span class="kn">import</span> <span class="nn">os.path</span>
<span class="kn">import</span> <span class="nn">os</span>
<span class="n">sys</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">abspath</span><span class="p">(</span><span class="n">__file__</span><span class="p">))</span> <span class="o">+</span> <span class="s2">&quot;/..&quot;</span><span class="p">)</span>
<span class="kn">import</span> <span class="nn">warnings</span>
<span class="n">warnings</span><span class="o">.</span><span class="n">filterwarnings</span><span class="p">(</span><span class="s1">&#39;ignore&#39;</span><span class="p">)</span>

<div class="viewcode-block" id="CrimeMapper"><a class="viewcode-back" href="../../html/CrimeTime/doc/backend.html#backend.CrimeMapper.CrimeMapper">[docs]</a><span class="k">class</span> <span class="nc">CrimeMapper</span><span class="p">:</span>
	<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">	This is the main class for CrimeTime. It will deal with all the backend</span>
<span class="sd">	data management and interacting with the SQLite database.</span>

<span class="sd">	It will be used by :class:`backend.Forecasting.Seasonal_ARIMA` class.</span>


<span class="sd">	:attributes:</span>
<span class="sd">	------------</span>

<span class="sd">		**production_mode** (boolean):</span>
<span class="sd">			Boolean to describe if code is running in production mode. Will be</span>
<span class="sd">			used for describing where database is.</span>

<span class="sd">		**geo_df** (`GeoPandas DataFrame &lt;http://geopandas.org/data_structures.html#geodataframe&gt;`_):</span>
<span class="sd">			The GeoPandas DataFrame of the geojson file, to plot the NYPD Precincts.</span>

<span class="sd">		**prec_found** (boolean):</span>
<span class="sd">			Boolean to record if the police precinct of the user entered address has been found.</span>
<span class="sd">		</span>
<span class="sd">		**location** (dict):</span>
<span class="sd">			Dictionary returned by `geopy &lt;https://pypi.python.org/pypi/geopy/1.11.0&gt;`_</span>
<span class="sd">			of the address, lattitude and longitude.</span>

<span class="sd">		**address** (str): </span>
<span class="sd">			Address returned by `geopy &lt;https://pypi.python.org/pypi/geopy/1.11.0&gt;`_ .</span>

<span class="sd">		**prec** (int):</span>
<span class="sd">			Police precinct of the address.</span>
<span class="sd">		</span>
<span class="sd">		**crime_name** (str):</span>
<span class="sd">			The name of the crime, i.e., &#39;Larceny&#39;, &#39;Assault&#39;, etc.</span>

<span class="sd">		**crime_df** (`Pandas DataFrame &lt;http://pandas.pydata.org/pandas-docs/stable/generated/pandas.DataFrame.html&gt;`_):</span>
<span class="sd">			The Pandas DataFrame for the selected &#39;crime_name&#39; history of the selected police precinct.</span>

<span class="sd">		**ts** (`Pandas DataFrame &lt;http://pandas.pydata.org/pandas-docs/stable/generated/pandas.DataFrame.html&gt;`_):</span>
<span class="sd">			The Pandas DataFrame that will act as our monthly time series data for our </span>
<span class="sd">			precinct and selected crime.</span>

<span class="sd">		**sql_query** (str): </span>
<span class="sd">			The SQL query that will depend on the crime type and police precinct.</span>

<span class="sd">		**DAYS_OF_CRIME** (`Pandas DataFrame &lt;http://pandas.pydata.org/pandas-docs/stable/generated/pandas.DataFrame.html&gt;`_):</span>
<span class="sd">			Pandas Series which contain the day of week and the percentage of crimes that occured on each day.</span>

<span class="sd">		**TIME_OF_DAY** (`Pandas DataFrame &lt;http://pandas.pydata.org/pandas-docs/stable/generated/pandas.DataFrame.html&gt;`_):</span>
<span class="sd">			Pandas Series which contain the hours of the day and the percentage of crimes that occured at each hour.</span>

<span class="sd">		**assault_ ts** (`Pandas DataFrame &lt;http://pandas.pydata.org/pandas-docs/stable/generated/pandas.DataFrame.html&gt;`_):</span>
<span class="sd">			The Pandas DataFrame that will have the monlthy trends in the assault.</span>

<span class="sd">		**burglary ts** (`Pandas DataFrame &lt;http://pandas.pydata.org/pandas-docs/stable/generated/pandas.DataFrame.html&gt;`_):</span>
<span class="sd">			The Pandas DataFrame that will have the monlthy trends in the burglary.</span>

<span class="sd">		**larceny ts** (`Pandas DataFrame &lt;http://pandas.pydata.org/pandas-docs/stable/generated/pandas.DataFrame.html&gt;`_):</span>
<span class="sd">			The Pandas DataFrame that will have the monlthy trends in the larceny.</span>

<span class="sd">		**car_ts** (`Pandas DataFrame &lt;http://pandas.pydata.org/pandas-docs/stable/generated/pandas.DataFrame.html&gt;`_):</span>
<span class="sd">			The Pandas DataFrame that will have the monlthy trends in the car theft.</span>

<span class="sd">		**robbery_ts** (`Pandas DataFrame &lt;http://pandas.pydata.org/pandas-docs/stable/generated/pandas.DataFrame.html&gt;`_):</span>
<span class="sd">			The Pandas DataFrame that will have the monlthy trends in the robbery.</span>
<span class="sd">	:methods:</span>
<span class="sd">	&quot;&quot;&quot;</span>    
    
	<span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">production_mode</span><span class="p">):</span>
		<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">		Constructor just makes a GeoPandas &lt;http://geopandas.org/data_structures.html#geodataframe&gt;`_)</span>
<span class="sd">		based off the police precincts in the /data/ directory.</span>

<span class="sd">		:Parameters: production_mode (boolean):</span>
<span class="sd">			Boolean to describe if code is running in production mode. Will be</span>
<span class="sd">			used for describing where database is.</span>

<span class="sd">		&quot;&quot;&quot;</span>
		<span class="c1">## Boolean to know to run in production mode, changes location of database</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">production_mode</span> <span class="o">=</span> <span class="n">production_mode</span>

		<span class="c1">## Geolocator object</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">_geolocator</span> <span class="o">=</span> <span class="n">Nominatim</span><span class="p">()</span>
	
		<span class="c1">## Police precinct geopandas dataframe</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">geo_df</span> <span class="o">=</span> <span class="kc">None</span>

		<span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">production_mode</span> <span class="o">==</span> <span class="kc">True</span><span class="p">:</span>
			<span class="bp">self</span><span class="o">.</span><span class="n">geo_df</span> <span class="o">=</span> <span class="n">gpd</span><span class="o">.</span><span class="n">read_file</span><span class="p">(</span><span class="s2">&quot;./data/NYC_Police_Precincts.geojson&quot;</span><span class="p">)</span>
		<span class="k">else</span><span class="p">:</span>
			<span class="bp">self</span><span class="o">.</span><span class="n">geo_df</span> <span class="o">=</span> <span class="n">gpd</span><span class="o">.</span><span class="n">read_file</span><span class="p">(</span><span class="s2">&quot;../data/NYC_Police_Precincts.geojson&quot;</span><span class="p">)</span>
		
		<span class="c1">## boolean as to whether the precinct was found in the find_precinct call</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">prec_found</span>    <span class="o">=</span> <span class="kc">None</span>

		<span class="c1">## The location dictionary returned by geopy</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">location</span>      <span class="o">=</span> <span class="kc">None</span>

		<span class="c1">## Address of the location from geopy</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">address</span>       <span class="o">=</span> <span class="kc">None</span> 

		<span class="c1">## Precinct of the address</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">prec</span>		   <span class="o">=</span> <span class="kc">None</span>
		
		<span class="c1">## The name crime the user input</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">crime_name</span>    <span class="o">=</span> <span class="kc">None</span>

		<span class="c1">## Dataframe which contains all the crime data for precinct and type of crime</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">crime_df</span>	   <span class="o">=</span> <span class="kc">None</span>

		<span class="c1">## Dataframe monthly crime data</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">ts</span>			   <span class="o">=</span> <span class="kc">None</span>

		<span class="c1">## Dataframe that has all days in the week and the crimes occurring each day</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">DAYS_OF_CRIME</span> <span class="o">=</span> <span class="kc">None</span>

		<span class="c1">## Dataframe that has all the hours in the day and the crimes occurring each hour</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">CRIME_HOURS</span>   <span class="o">=</span> <span class="kc">None</span>

		<span class="c1">## sql_query to </span>
		<span class="bp">self</span><span class="o">.</span><span class="n">sql_query</span>	   <span class="o">=</span> <span class="kc">None</span>

		<span class="c1">#</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">assault_ts</span>    <span class="o">=</span> <span class="kc">None</span>

		<span class="bp">self</span><span class="o">.</span><span class="n">larceny_ts</span>    <span class="o">=</span> <span class="kc">None</span>

		<span class="bp">self</span><span class="o">.</span><span class="n">robbery_ts</span>    <span class="o">=</span> <span class="kc">None</span>

		<span class="bp">self</span><span class="o">.</span><span class="n">burglary_ts</span>   <span class="o">=</span> <span class="kc">None</span>

		<span class="bp">self</span><span class="o">.</span><span class="n">car_ts</span>        <span class="o">=</span> <span class="kc">None</span>


<div class="viewcode-block" id="CrimeMapper.find_precinct"><a class="viewcode-back" href="../../html/CrimeTime/doc/backend.html#backend.CrimeMapper.CrimeMapper.find_precinct">[docs]</a>	<span class="k">def</span> <span class="nf">find_precinct</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">address</span><span class="p">):</span>
		<span class="sd">&quot;&quot;&quot; </span>
<span class="sd">		Takes in address and finds the police precint the address belongs to.</span>

<span class="sd">		:Parameters: address (str): </span>
<span class="sd">			The address contianing number, street and borough.</span>

<span class="sd">		:returns: </span>
<span class="sd">			Boolean of whether the police precinct of address is found.</span>

<span class="sd">		:rtype: </span>
<span class="sd">			Boolean.</span>
<span class="sd">		&quot;&quot;&quot;</span>

		<span class="c1">## Boolean of whether the precinct of address is found	</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">prec_found</span> <span class="o">=</span> <span class="kc">False</span>
		<span class="c1">## location of the address</span>
		<span class="k">try</span><span class="p">:</span>
			<span class="bp">self</span><span class="o">.</span><span class="n">location</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_geolocator</span><span class="o">.</span><span class="n">geocode</span><span class="p">(</span><span class="n">address</span><span class="p">)</span>
		<span class="k">except</span><span class="p">:</span>
			<span class="k">pass</span>
		
		<span class="k">if</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">location</span> <span class="o">==</span> <span class="kc">None</span><span class="p">):</span>
			<span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">prec_found</span>
		<span class="k">else</span><span class="p">:</span>
			<span class="bp">self</span><span class="o">.</span><span class="n">address</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">location</span><span class="o">.</span><span class="n">address</span>
	
			<span class="c1"># Get the longitude and latitude of the address</span>
			<span class="n">point</span> <span class="o">=</span>  <span class="n">Point</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">location</span><span class="o">.</span><span class="n">longitude</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">location</span><span class="o">.</span><span class="n">latitude</span><span class="p">)</span>

			<span class="c1"># Central coordinates for NYC</span>
			<span class="bp">self</span><span class="o">.</span><span class="n">nyc_coor</span> <span class="o">=</span> <span class="p">[</span><span class="mf">40.7128</span><span class="p">,</span><span class="o">-</span><span class="mf">74.0059</span><span class="p">]</span>

 			<span class="c1"># Loop through all the NYC precincts geometries and</span>
			<span class="c1"># find which precinct the address is in.</span>
			<span class="n">N</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">geo_df</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
			<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">N</span><span class="p">):</span>
	 			<span class="k">if</span><span class="p">(</span><span class="n">point</span><span class="o">.</span><span class="n">within</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">geo_df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="s1">&#39;geometry&#39;</span><span class="p">])):</span>
 					<span class="bp">self</span><span class="o">.</span><span class="n">prec</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">geo_df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="s1">&#39;precinct&#39;</span><span class="p">])</span>
					<span class="bp">self</span><span class="o">.</span><span class="n">prec_found</span> <span class="o">=</span> <span class="kc">True</span>

			<span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">production_mode</span><span class="p">:</span>
				<span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">prec_found</span></div>
	

<div class="viewcode-block" id="CrimeMapper.get_all_crime_data"><a class="viewcode-back" href="../../html/CrimeTime/doc/backend.html#backend.CrimeMapper.CrimeMapper.get_all_crime_data">[docs]</a>	<span class="k">def</span> <span class="nf">get_all_crime_data</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
		<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">		Get all the crime data for this police precinct (excluding rape </span>
<span class="sd">		and murder) by querying the SQLite database.</span>

<span class="sd">		**NOTE:** find_precinct() must have been called first.</span>
<span class="sd">		&quot;&quot;&quot;</span>

		<span class="bp">self</span><span class="o">.</span><span class="n">sql_query</span> <span class="o">=</span> <span class="s1">&#39;SELECT * FROM NYC_CRIME WHERE PRECINCT = &#39;</span>\
				<span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">prec</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39; AND OFFENSE != </span><span class="se">\&#39;</span><span class="s1">RAPE</span><span class="se">\&#39;</span><span class="s1">&#39;</span>\
				<span class="o">+</span> <span class="s1">&#39;AND OFFENSE != </span><span class="se">\&#39;</span><span class="s1">MURDER &amp; NON-NEGL. MANSLAUGHTER</span><span class="se">\&#39;</span><span class="s1">&#39;</span>

		<span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">production_mode</span> <span class="o">==</span> <span class="kc">True</span><span class="p">:</span>
			<span class="n">conn</span> <span class="o">=</span> <span class="n">sqlite3</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s1">&#39;./data/CrimeTime.db&#39;</span><span class="p">)</span>
		<span class="k">else</span><span class="p">:</span>
			<span class="n">conn</span> <span class="o">=</span> <span class="n">sqlite3</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s1">&#39;../data/CrimeTime.db&#39;</span><span class="p">)</span>

		<span class="c1"># The crime dataframe for the selected police precint.</span>
		<span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_sql_query</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">sql_query</span><span class="p">,</span> <span class="n">conn</span><span class="p">)</span>
		<span class="n">conn</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>

		<span class="c1"># Make the trend time series for all the different crimes</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">crime_df</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="n">df</span><span class="o">.</span><span class="n">OFFENSE</span> <span class="o">==</span> <span class="s1">&#39;FELONY ASSAULT&#39;</span><span class="p">]</span> 
		<span class="bp">self</span><span class="o">.</span><span class="n">make_time_series</span><span class="p">()</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">assault_ts</span> <span class="o">=</span> <span class="n">seasonal_decompose</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ts</span><span class="p">,</span><span class="n">freq</span><span class="o">=</span><span class="mi">12</span><span class="p">)</span><span class="o">.</span><span class="n">trend</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">assault_ts</span><span class="o">.</span><span class="n">dropna</span><span class="p">(</span><span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

		<span class="bp">self</span><span class="o">.</span><span class="n">crime_df</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="n">df</span><span class="o">.</span><span class="n">OFFENSE</span> <span class="o">==</span> <span class="s1">&#39;ROBBERY&#39;</span><span class="p">]</span> 
		<span class="bp">self</span><span class="o">.</span><span class="n">make_time_series</span><span class="p">()</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">robbery_ts</span>  <span class="o">=</span> <span class="n">seasonal_decompose</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ts</span><span class="p">,</span><span class="n">freq</span><span class="o">=</span><span class="mi">12</span><span class="p">)</span><span class="o">.</span><span class="n">trend</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">robbery_ts</span><span class="o">.</span><span class="n">dropna</span><span class="p">(</span><span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

		<span class="bp">self</span><span class="o">.</span><span class="n">crime_df</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="n">df</span><span class="o">.</span><span class="n">OFFENSE</span> <span class="o">==</span> <span class="s1">&#39;GRAND LARCENY&#39;</span><span class="p">]</span> 
		<span class="bp">self</span><span class="o">.</span><span class="n">make_time_series</span><span class="p">()</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">larceny_ts</span>  <span class="o">=</span> <span class="n">seasonal_decompose</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ts</span><span class="p">,</span><span class="n">freq</span><span class="o">=</span><span class="mi">12</span><span class="p">)</span><span class="o">.</span><span class="n">trend</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">larceny_ts</span><span class="o">.</span><span class="n">dropna</span><span class="p">(</span><span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

		<span class="bp">self</span><span class="o">.</span><span class="n">crime_df</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="n">df</span><span class="o">.</span><span class="n">OFFENSE</span> <span class="o">==</span> <span class="s1">&#39;BURGLARY&#39;</span><span class="p">]</span> 
		<span class="bp">self</span><span class="o">.</span><span class="n">make_time_series</span><span class="p">()</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">burglary_ts</span>  <span class="o">=</span> <span class="n">seasonal_decompose</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ts</span><span class="p">,</span><span class="n">freq</span><span class="o">=</span><span class="mi">12</span><span class="p">)</span><span class="o">.</span><span class="n">trend</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">burglary_ts</span><span class="o">.</span><span class="n">dropna</span><span class="p">(</span><span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

		<span class="bp">self</span><span class="o">.</span><span class="n">crime_df</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="n">df</span><span class="o">.</span><span class="n">OFFENSE</span> <span class="o">==</span> <span class="s1">&#39;GRAND LARCENY OF MOTOR VEHICLE&#39;</span><span class="p">]</span> 
		<span class="bp">self</span><span class="o">.</span><span class="n">make_time_series</span><span class="p">()</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">car_ts</span>  <span class="o">=</span> <span class="n">seasonal_decompose</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ts</span><span class="p">,</span><span class="n">freq</span><span class="o">=</span><span class="mi">12</span><span class="p">)</span><span class="o">.</span><span class="n">trend</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">car_ts</span><span class="o">.</span><span class="n">dropna</span><span class="p">(</span><span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span></div>

<div class="viewcode-block" id="CrimeMapper.get_crime_data"><a class="viewcode-back" href="../../html/CrimeTime/doc/backend.html#backend.CrimeMapper.CrimeMapper.get_crime_data">[docs]</a>	<span class="k">def</span> <span class="nf">get_crime_data</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">crime_name</span><span class="p">):</span>
		<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">		Gets the crime data for the user supplied crime in the users </span>
<span class="sd">		police precinct from the SQLite database.</span>

<span class="sd">		**NOTE:** find_precinct() must have been called first.</span>

<span class="sd">		:Parameters: crime_name (str): </span>
<span class="sd">			The user selected crime. Accepts:</span>

<span class="sd">			* &#39;Larceny&#39;</span>
<span class="sd">			* &#39;Robbery&#39;</span>
<span class="sd">			* &#39;Assault&#39; </span>
<span class="sd">			* &#39;Burglary&#39;</span>
<span class="sd">			* &#39;Car Theft&#39;</span>
<span class="sd">		&quot;&quot;&quot;</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">crime_name</span> <span class="o">=</span> <span class="n">crime_name</span>
		<span class="n">dont_continue</span> <span class="o">=</span> <span class="kc">False</span>

		<span class="k">if</span><span class="p">(</span><span class="n">crime_name</span> <span class="o">==</span> <span class="s1">&#39;Larceny&#39;</span><span class="p">):</span>
			<span class="bp">self</span><span class="o">.</span><span class="n">crime_name</span> <span class="o">=</span> <span class="s1">&#39;GRAND LARCENY&#39;</span>
		<span class="k">elif</span><span class="p">(</span><span class="n">crime_name</span> <span class="o">==</span> <span class="s1">&#39;Robbery&#39;</span><span class="p">):</span>
			<span class="bp">self</span><span class="o">.</span><span class="n">crime_name</span> <span class="o">=</span> <span class="s1">&#39;ROBBERY&#39;</span>
		<span class="k">elif</span><span class="p">(</span><span class="n">crime_name</span> <span class="o">==</span> <span class="s1">&#39;Assault&#39;</span><span class="p">):</span>
			<span class="bp">self</span><span class="o">.</span><span class="n">crime_name</span> <span class="o">=</span> <span class="s1">&#39;FELONY ASSAULT&#39;</span>
		<span class="k">elif</span><span class="p">(</span><span class="n">crime_name</span> <span class="o">==</span> <span class="s1">&#39;Burglary&#39;</span><span class="p">):</span>
			<span class="bp">self</span><span class="o">.</span><span class="n">crime_name</span> <span class="o">=</span> <span class="s1">&#39;BURGLARY&#39;</span>
		<span class="k">elif</span><span class="p">(</span><span class="n">crime_name</span> <span class="o">==</span> <span class="s1">&#39;Car Theft&#39;</span><span class="p">):</span>
			<span class="bp">self</span><span class="o">.</span><span class="n">crime_name</span> <span class="o">=</span> <span class="s1">&#39;GRAND LARCENY OF MOTOR VEHICLE&#39;</span>
		<span class="k">else</span><span class="p">:</span>
			<span class="n">dont_continue</span> <span class="o">=</span> <span class="kc">True</span>
			<span class="nb">print</span> <span class="s2">&quot;Cant Work With That Crime Type&quot;</span>

		<span class="k">if</span><span class="p">(</span><span class="n">dont_continue</span> <span class="o">==</span> <span class="kc">False</span><span class="p">):</span>
			<span class="bp">self</span><span class="o">.</span><span class="n">sql_query</span> <span class="o">=</span> <span class="s1">&#39;SELECT * FROM NYC_CRIME WHERE PRECINCT = &#39;</span>\
					<span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">prec</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39; AND OFFENSE = </span><span class="se">\&#39;</span><span class="s1">&#39;</span> \
					<span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">crime_name</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;</span><span class="se">\&#39;</span><span class="s1"> &#39;</span> 

			<span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">production_mode</span> <span class="o">==</span> <span class="kc">True</span><span class="p">:</span>
				<span class="n">conn</span> <span class="o">=</span> <span class="n">sqlite3</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s1">&#39;./data/CrimeTime.db&#39;</span><span class="p">)</span>
			<span class="k">else</span><span class="p">:</span>
				<span class="n">conn</span> <span class="o">=</span> <span class="n">sqlite3</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s1">&#39;../data/CrimeTime.db&#39;</span><span class="p">)</span>

			<span class="c1"># The crime dataframe for the selected police precint.</span>
			<span class="bp">self</span><span class="o">.</span><span class="n">crime_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_sql_query</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">sql_query</span><span class="p">,</span> <span class="n">conn</span><span class="p">)</span>
			<span class="n">conn</span><span class="o">.</span><span class="n">close</span><span class="p">()</span></div>
        
<div class="viewcode-block" id="CrimeMapper.restamp"><a class="viewcode-back" href="../../html/CrimeTime/doc/backend.html#backend.CrimeMapper.CrimeMapper.restamp">[docs]</a>	<span class="k">def</span> <span class="nf">restamp</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">row</span><span class="p">):</span>
		<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">		Rewrite the date into an appropriate formate for pandas time series.</span>
<span class="sd">		</span>
<span class="sd">		:Parameters: row (str):</span>
<span class="sd">			The string that contains the stamp, e.g.: &#39;01/31/2006 12:00:00 AM&#39;</span>
<span class="sd">	</span>
<span class="sd">		:returns: (str)</span>
<span class="sd">			The datetime.date version of the date, e.g. &#39;01-31-2006&#39;</span>
<span class="sd">		</span>
<span class="sd">		:rtype: str</span>

<span class="sd">		&quot;&quot;&quot;</span>
		<span class="k">return</span> <span class="n">datetime</span><span class="o">.</span><span class="n">strptime</span><span class="p">(</span><span class="n">row</span><span class="p">,</span> <span class="s1">&#39;%m/</span><span class="si">%d</span><span class="s1">/%Y %I:%M:%S %p&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">date</span><span class="p">()</span></div>
    
<div class="viewcode-block" id="CrimeMapper.make_time_series"><a class="viewcode-back" href="../../html/CrimeTime/doc/backend.html#backend.CrimeMapper.CrimeMapper.make_time_series">[docs]</a>	<span class="k">def</span> <span class="nf">make_time_series</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
		<span class="sd">&quot;&quot;&quot; </span>
<span class="sd">		Rewrites the self.crime_df into self.ts where the crimes have been resampled</span>
<span class="sd">		for each month.</span>
<span class="sd">		&quot;&quot;&quot;</span>
		<span class="n">aux</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">crime_df</span><span class="p">[</span><span class="s1">&#39;DATE&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">restamp</span><span class="p">)</span>
		<span class="n">temp</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span><span class="n">Counter</span><span class="p">(</span><span class="n">aux</span><span class="p">))</span>
		<span class="c1">## The pandas time series of the monthly number of specified crimes in precinct</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">ts</span> <span class="o">=</span> <span class="n">temp</span><span class="o">.</span><span class="n">to_frame</span><span class="p">()</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">ts</span><span class="o">.</span><span class="n">reset_index</span><span class="p">(</span><span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">ts</span><span class="o">.</span><span class="n">columns</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;Date&#39;</span><span class="p">,</span><span class="s1">&#39;Crimes&#39;</span><span class="p">]</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">ts</span><span class="p">[</span><span class="s1">&#39;Date&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">to_datetime</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ts</span><span class="p">[</span><span class="s1">&#39;Date&#39;</span><span class="p">])</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">ts</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ts</span><span class="o">.</span><span class="n">set_index</span><span class="p">(</span><span class="s1">&#39;Date&#39;</span><span class="p">)</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">ts</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ts</span><span class="o">.</span><span class="n">resample</span><span class="p">(</span><span class="s1">&#39;M&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>
		<span class="k">if</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ts</span><span class="o">.</span><span class="n">isnull</span><span class="p">()</span><span class="o">.</span><span class="n">values</span><span class="o">.</span><span class="n">any</span><span class="p">()):</span>
			<span class="bp">self</span><span class="o">.</span><span class="n">ts</span><span class="o">.</span><span class="n">dropna</span><span class="p">(</span><span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>           </div>

<div class="viewcode-block" id="CrimeMapper.percent_per_day"><a class="viewcode-back" href="../../html/CrimeTime/doc/backend.html#backend.CrimeMapper.CrimeMapper.percent_per_day">[docs]</a>	<span class="k">def</span> <span class="nf">percent_per_day</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
		<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">		Makes a Pandas DataFrame for the number of crimes that occurred in </span>
<span class="sd">		the selected precinct on each day of the week.</span>
<span class="sd">		&quot;&quot;&quot;</span>
		<span class="n">CRIME_DAYS</span> <span class="o">=</span> <span class="mi">100</span> <span class="o">*</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">crime_df</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s1">&#39;WEEKDAY&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">size</span><span class="p">()</span> 
                    <span class="o">/</span><span class="bp">self</span><span class="o">.</span><span class="n">crime_df</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s1">&#39;WEEKDAY&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">size</span><span class="p">()</span><span class="o">.</span><span class="n">sum</span><span class="p">())</span>

		<span class="c1">#print type(CRIME_DAYS)</span>
    
		<span class="n">days</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;Monday&#39;</span><span class="p">,</span><span class="s1">&#39;Tuesday&#39;</span><span class="p">,</span><span class="s1">&#39;Wednesday&#39;</span><span class="p">,</span>
						<span class="s1">&#39;Thursday&#39;</span><span class="p">,</span><span class="s1">&#39;Friday&#39;</span><span class="p">,</span><span class="s1">&#39;Saturday&#39;</span><span class="p">,</span><span class="s1">&#39;Sunday&#39;</span><span class="p">]</span>
    
		<span class="c1">## Time series of the number of crimes that occurred in the day of week</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">DAYS_OF_CRIME</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">()</span>
		<span class="k">for</span> <span class="n">day</span> <span class="ow">in</span> <span class="n">days</span><span class="p">:</span>
			<span class="bp">self</span><span class="o">.</span><span class="n">DAYS_OF_CRIME</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">day</span><span class="p">]</span> <span class="o">=</span> <span class="n">CRIME_DAYS</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">day</span><span class="p">]</span></div>
    
        
<div class="viewcode-block" id="CrimeMapper.percent_per_hour"><a class="viewcode-back" href="../../html/CrimeTime/doc/backend.html#backend.CrimeMapper.CrimeMapper.percent_per_hour">[docs]</a>	<span class="k">def</span> <span class="nf">percent_per_hour</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
		<span class="sd">&quot;&quot;&quot; </span>
<span class="sd">		Makes a Pandas DataFrame for the number of crimes that occurred in </span>
<span class="sd">		the selected precinct on hour of the day.</span>
<span class="sd">		&quot;&quot;&quot;</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">crime_df</span><span class="p">[</span><span class="s1">&#39;HOUR&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">crime_df</span><span class="p">[</span><span class="s1">&#39;HOUR&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">CRIME_HOURS</span> <span class="o">=</span>  <span class="bp">self</span><span class="o">.</span><span class="n">crime_df</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s1">&#39;HOUR&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">size</span><span class="p">()</span> <span class="c1">#\</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">CRIME_HOURS</span> <span class="o">=</span> <span class="mi">100</span> <span class="o">*</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">CRIME_HOURS</span>
                          <span class="o">/</span><span class="bp">self</span><span class="o">.</span><span class="n">CRIME_HOURS</span><span class="o">.</span><span class="n">sum</span><span class="p">())</span></div>

<div class="viewcode-block" id="CrimeMapper.get_precinct"><a class="viewcode-back" href="../../html/CrimeTime/doc/backend.html#backend.CrimeMapper.CrimeMapper.get_precinct">[docs]</a>	<span class="k">def</span> <span class="nf">get_precinct</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
		<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">		Returns the precinct of the address that was searched for.</span>
<span class="sd">		</span>
<span class="sd">		:returns: prec</span>
<span class="sd">		:rtype: int</span>
<span class="sd">		&quot;&quot;&quot;</span>
		<span class="k">return</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">prec</span><span class="p">)</span></div>

<div class="viewcode-block" id="CrimeMapper.get_address"><a class="viewcode-back" href="../../html/CrimeTime/doc/backend.html#backend.CrimeMapper.CrimeMapper.get_address">[docs]</a>	<span class="k">def</span> <span class="nf">get_address</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
		<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">		Returns the address that was searched for.</span>
<span class="sd">		</span>
<span class="sd">		:returns: address</span>
<span class="sd">		:rtype: str</span>
<span class="sd">		&quot;&quot;&quot;</span>
		<span class="k">return</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">address</span><span class="p">)</span></div>

<div class="viewcode-block" id="CrimeMapper.get_precinct_info"><a class="viewcode-back" href="../../html/CrimeTime/doc/backend.html#backend.CrimeMapper.CrimeMapper.get_precinct_info">[docs]</a>	<span class="k">def</span> <span class="nf">get_precinct_info</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
		<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">		This function will query the SQLite databse to obtain</span>
<span class="sd">		the police precinct info for users precinct.</span>

<span class="sd">		:returns: precinct&#39;s name, address and telephone number.</span>
<span class="sd">		:rtype: dict</span>
<span class="sd">		&quot;&quot;&quot;</span>
		<span class="n">sql_query</span> <span class="o">=</span> <span class="s1">&#39;SELECT * FROM NYC_Precint_Info WHERE Precinct= &#39;</span>\
				<span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">prec</span><span class="p">)</span>

		<span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">production_mode</span> <span class="o">==</span> <span class="kc">True</span><span class="p">:</span>		
			<span class="n">conn</span> <span class="o">=</span> <span class="n">sqlite3</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s1">&#39;./data/CrimeTime.db&#39;</span><span class="p">)</span>
		<span class="k">else</span><span class="p">:</span>
			<span class="n">conn</span> <span class="o">=</span> <span class="n">sqlite3</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s1">&#39;../data/CrimeTime.db&#39;</span><span class="p">)</span>

		<span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_sql_query</span><span class="p">(</span><span class="n">sql_query</span><span class="p">,</span> <span class="n">conn</span><span class="p">)</span>
		<span class="n">conn</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
	
		<span class="n">precinct_info</span> <span class="o">=</span> <span class="p">{}</span>

		<span class="n">precinct_info</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;Name&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">])</span>
		<span class="n">precinct_info</span><span class="p">[</span><span class="s1">&#39;address&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;Address&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">])</span>
		<span class="n">precinct_info</span><span class="p">[</span><span class="s1">&#39;tele&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;Telephone&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">])</span>

		<span class="k">return</span> <span class="n">precinct_info</span></div>

<div class="viewcode-block" id="CrimeMapper.plot_decompose"><a class="viewcode-back" href="../../html/CrimeTime/doc/backend.html#backend.CrimeMapper.CrimeMapper.plot_decompose">[docs]</a>	<span class="k">def</span> <span class="nf">plot_decompose</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
		<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">		This plots the raw monthly number of crimes, as well as the trend and seasonality</span>
<span class="sd">		of crime in the precinct.  Under the hood it is calling StatsModels&#39;</span>
<span class="sd">		`seasonal_decompose(...) &lt;http://www.statsmodels.org/dev/generated/statsmodels.tsa.seasonal.seasonal_decompose.html&gt;`_</span>
<span class="sd">		&quot;&quot;&quot;</span>
		<span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">9</span><span class="p">,</span> <span class="mi">5</span><span class="p">))</span>
		<span class="n">plt</span><span class="o">.</span><span class="n">clf</span><span class="p">()</span>

		<span class="n">decomp_crime</span> <span class="o">=</span> <span class="n">seasonal_decompose</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ts</span><span class="p">,</span><span class="n">freq</span><span class="o">=</span><span class="mi">12</span><span class="p">)</span>
		<span class="n">season_crime</span> <span class="o">=</span> <span class="n">decomp_crime</span><span class="o">.</span><span class="n">seasonal</span>
		<span class="n">trend_crime</span>   <span class="o">=</span> <span class="n">decomp_crime</span><span class="o">.</span><span class="n">trend</span>
		
		<span class="n">title</span> <span class="o">=</span> <span class="s1">&#39;Decomposition Of Crimes Involving &#39;</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">crime_name</span> <span class="o">+</span>\
						<span class="s1">&#39; in Precinct &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">prec</span><span class="p">)</span>

		<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ts</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Monthly data&#39;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>
		<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">season_crime</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Seasonality&#39;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>
		<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">trend_crime</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Trend&#39;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>
		<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="n">title</span><span class="p">,</span><span class="n">fontsize</span><span class="o">=</span><span class="mi">13</span><span class="p">)</span>
		<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;Year&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">13</span><span class="p">)</span>
		<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span></div>


<div class="viewcode-block" id="CrimeMapper.plot_per_day"><a class="viewcode-back" href="../../html/CrimeTime/doc/backend.html#backend.CrimeMapper.CrimeMapper.plot_per_day">[docs]</a>	<span class="k">def</span> <span class="nf">plot_per_day</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
		<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">		Makes a bar plot of percent of crimes which occur during each day in the week.</span>
<span class="sd">		&quot;&quot;&quot;</span>
		<span class="n">plt</span><span class="o">.</span><span class="n">clf</span><span class="p">()</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">percent_per_day</span><span class="p">()</span>
		
		<span class="n">title</span> <span class="o">=</span> <span class="s1">&#39;Percentage of &#39;</span> <span class="o">+</span>\
			<span class="bp">self</span><span class="o">.</span><span class="n">crime_name</span> <span class="o">+</span><span class="s1">&#39; in Precinct &#39;</span> <span class="o">+</span>\
			<span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">prec</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39; by day of week&#39;</span> 
        
		<span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span> <span class="mi">5</span><span class="p">))</span>
  	      
 		<span class="bp">self</span><span class="o">.</span><span class="n">DAYS_OF_CRIME</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">kind</span><span class="o">=</span><span class="s1">&#39;bar&#39;</span><span class="p">)</span>
      
		<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="n">title</span><span class="p">,</span><span class="n">fontsize</span><span class="o">=</span><span class="mi">13</span><span class="p">)</span>
		<span class="n">plt</span><span class="o">.</span><span class="n">yticks</span><span class="p">(</span><span class="n">size</span><span class="o">=</span><span class="mi">14</span><span class="p">)</span>
 		<span class="n">plt</span><span class="o">.</span><span class="n">xticks</span><span class="p">(</span><span class="n">rotation</span><span class="o">=</span><span class="mi">30</span><span class="p">,</span><span class="n">size</span><span class="o">=</span><span class="mi">14</span><span class="p">)</span>
		<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Percent of crimes&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">13</span><span class="p">)</span></div>

<div class="viewcode-block" id="CrimeMapper.plot_per_hour"><a class="viewcode-back" href="../../html/CrimeTime/doc/backend.html#backend.CrimeMapper.CrimeMapper.plot_per_hour">[docs]</a>	<span class="k">def</span> <span class="nf">plot_per_hour</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
		<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">		Makes a bar plot of percent of crimes which occur during each day in the week.</span>
<span class="sd">		&quot;&quot;&quot;</span>
		<span class="n">plt</span><span class="o">.</span><span class="n">clf</span><span class="p">()</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">percent_per_hour</span><span class="p">()</span>
		<span class="n">title</span> <span class="o">=</span> <span class="s1">&#39;Percentage of &#39;</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">crime_name</span> <span class="o">+</span>\
			<span class="s1">&#39; in Precinct &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">prec</span><span class="p">)</span> <span class="o">+</span>\
			<span class="s1">&#39; by time of day&#39;</span> 

		<span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span> <span class="mi">5</span><span class="p">))</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">CRIME_HOURS</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">kind</span><span class="o">=</span><span class="s1">&#39;bar&#39;</span><span class="p">)</span>
		<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="n">title</span><span class="p">,</span><span class="n">fontsize</span><span class="o">=</span><span class="mi">13</span><span class="p">)</span>
		<span class="n">plt</span><span class="o">.</span><span class="n">yticks</span><span class="p">(</span><span class="n">size</span><span class="o">=</span><span class="mi">14</span><span class="p">)</span>
		<span class="n">plt</span><span class="o">.</span><span class="n">xticks</span><span class="p">(</span><span class="n">rotation</span><span class="o">=</span><span class="mi">45</span><span class="p">,</span><span class="n">size</span><span class="o">=</span><span class="mi">16</span><span class="p">)</span>
		<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;Hour In Day&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">13</span><span class="p">)</span>
		<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Pecent of crimes&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">13</span><span class="p">)</span></div></div>
</pre></div>

          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<div id="searchbox" style="display: none" role="search">
  <h3>Quick search</h3>
    <form class="search" action="../../search.html" method="get">
      <div><input type="text" name="q" /></div>
      <div><input type="submit" value="Go" /></div>
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="../../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="nav-item nav-item-0"><a href="../../index.html">CrimeTime  documentation</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="../index.html" >Module code</a> &#187;</li> 
      </ul>
    </div>
    <div class="footer" role="contentinfo">
        &#169; Copyright 2017, Michael Harmon.
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 1.4.6.
    </div>
  </body>
</html>